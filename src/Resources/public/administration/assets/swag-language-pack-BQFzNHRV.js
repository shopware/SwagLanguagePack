const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BJRzMIyM.js","assets/index-B2v7y-5u.css"])))=>i.map(i=>d[i]);
const{Criteria:h}=Shopware.Data,{warn:$}=Shopware.Utils.debug,P=Shopware.Service("repositoryFactory").create("language"),q=new h().addAssociation("swagLanguagePackLanguage").addAssociation("locale").addFilter(h.not("AND",[h.equals("swagLanguagePackLanguage.administrationActive",!1)])),f=Shopware.Plugin.addBootPromise();let b;P.search(q).then(e=>{e.forEach(a=>{Shopware.Locale.getByName(a.locale.code)||(b=a.locale.code,Shopware.Locale.register(a.locale.code,{}))}),f()}).catch(()=>{let e='Unable to register "packLanguages".';b!==void 0&&(e+=` Problems occurred while installing language: ${b}`),$("SwagLanguagePack",e),f()});const{Component:x,Defaults:A}=Shopware,{Criteria:w}=Shopware.Data;x.override("sw-language-switch",{computed:{languageCriteria(){return this.$super("languageCriteria").addFilter(w.multi("OR",[w.equals("extensions.swagLanguagePackLanguage.id",null),w.equals("extensions.swagLanguagePackLanguage.salesChannelActive",!0),w.equals("id",A.systemLanguageId)]))}}});const I="modulepreload",D=function(e){return window.__sw__.assetPath+"/bundles/swaglanguagepack/administration/"+e},C={},F=function(a,t,n){let i=Promise.resolve();if(t&&t.length>0){let c=function(g){return Promise.all(g.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),L=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));i=c(t.map(g=>{if(g=D(g),g in C)return;C[g]=!0;const u=g.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${d}`))return;const r=document.createElement("link");if(r.rel=u?"stylesheet":I,u||(r.as="script"),r.crossOrigin="",r.href=g,L&&r.setAttribute("nonce",L),document.head.appendChild(r),u)return new Promise((y,S)=>{r.addEventListener("load",y),r.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${g}`)))})}))}function l(c){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=c,window.dispatchEvent(s),!s.defaultPrevented)throw c}return i.then(c=>{for(const s of c||[])s.status==="rejected"&&l(s.reason);return a().catch(l)})};Shopware.Component.override("sw-extension-uninstall-modal",()=>F(()=>import("./index-BJRzMIyM.js"),__vite__mapDeps([0,1])));const{Component:R,Defaults:E}=Shopware,{Criteria:p}=Shopware.Data;R.override("sw-first-run-wizard-welcome",{methods:{getLanguageCriteria(){return this.$super("getLanguageCriteria").addAssociation("swagLanguagePackLanguage").addSorting(p.sort("name","ASC")).addFilter(p.multi("OR",[p.equals("extensions.swagLanguagePackLanguage.id",null),p.equals("extensions.swagLanguagePackLanguage.administrationActive",!0),p.equals("id",E.systemLanguageId)])).setLimit(null)}}});const{Component:T}=Shopware,{Criteria:B}=Shopware.Data;T.override("sw-sales-channel-detail-domains",{computed:{snippetSetCriteria(){const e=this.salesChannel.languages.map(a=>{var t;return(t=a.locale)==null?void 0:t.code}).filter(Boolean);return e.length===0?this.$super("snippetSetCriteria"):this.$super("snippetSetCriteria").addFilter(B.equalsAny("iso",e))}}});const{Component:U}=Shopware;U.override("sw-sales-channel-detail",{methods:{getLoadSalesChannelCriteria(){return this.$super("getLoadSalesChannelCriteria").addAssociation("languages.locale")}}});const{Component:O,Defaults:j}=Shopware,{Criteria:_}=Shopware.Data;O.override("sw-sales-channel-detail-base",{computed:{languageCriteria(){return this.$super("languageCriteria").addFilter(_.multi("OR",[_.equals("extensions.swagLanguagePackLanguage.id",null),_.equals("extensions.swagLanguagePackLanguage.salesChannelActive",!0),_.equals("id",j.systemLanguageId)]))}}});const M=`{% block sw_settings_language_list_content_list_delete_action %} <template #delete-action="{ item, showDelete }"> {% block sw_settings_language_list_content_list_delete_action_language_pack %} <template v-if="isPackLanguage(item.id)"> <sw-context-menu-item v-tooltip.bottom="$tc('swag-language-pack.sw-settings-language-list.deleteLanguagePackTooltip')" class="sw-settings-language-list__delete-action" variant="danger" disabled @click="showDelete(item.id)" > {{ $tc('global.default.delete') }} </sw-context-menu-item> </template> {% endblock %} {% block sw_settings_language_list_content_list_delete_action_language %} <template v-else> <sw-context-menu-item v-tooltip.bottom="tooltipDelete(item.id)" class="sw-settings-language-list__delete-action" variant="danger" :disabled="isDefault(item.id) || !allowDelete" @click="showDelete(item.id)" > {{ $tc('global.default.delete') }} </sw-context-menu-item> </template> {% endblock %} </template> {% endblock %}`,{Component:V}=Shopware,{Criteria:v}=Shopware.Data;V.override("sw-settings-language-list",{template:M,data(){return{packLanguageLanguageIds:[]}},computed:{packLanguageCriteria(){return new v(1,50).addFilter(v.not("and",[v.equals("swagLanguagePackLanguage.id",null)]))}},created(){this.createdComponent()},methods:{createdComponent(){this.getPackLanguageLanguageIds()},getPackLanguageLanguageIds(){this.languageRepository.searchIds(this.packLanguageCriteria).then(e=>{this.packLanguageLanguageIds=e.data})},isPackLanguage(e){return this.packLanguageLanguageIds.includes(e)}}});Shopware.Service("privileges").addPrivilegeMappingEntry({category:"permissions",parent:"settings",key:"language",roles:{viewer:{privileges:["sales_channel:read","sales_channel_domain:read"]},editor:{privileges:["swag_language_pack_language:update","user:read","user:update"]}}});const N='{% block swag_language_pack_flag %} <div class="swag-language-pack-flag"> <img :src="assetFilter(`swaglanguagepack/static/flags/${countryCode}.svg`)"> </div> {% endblock %}',{Component:H}=Shopware;H.register("swag-language-pack-flag",{template:N,props:{locale:{type:String,required:!1,default:""}},computed:{assetFilter(){return Shopware.Filter.getByName("asset")},countryCode(){return this.locale.split("-")[1].toLowerCase()}}});const z='{% block swag_pack_language_entry %} <div class="swag-language-pack-entry"> {% block swag_pack_language_entry_flag %} <div class="swag-language-pack-entry__flag-container"> <img :src="flagSource(flagLocale)" :alt="flagLocale" class="swag-language-pack-entry__flag"/> </div> {% endblock %} {% block swag_pack_language_entry_content %} <div class="swag-language-pack-entry__content"> {% block swag_pack_language_entry_content_name %} <div class="swag-language-pack-entry__name"> {{ label }} </div> {% endblock %} {% block swag_pack_language_entry_content_description %} <div class="swag-language-pack-entry__description"> {{ description }} </div> {% endblock %} </div> {% endblock %} {% block swag_pack_language_entry_switch %} <mt-switch class="swag-language-pack-entry__switch" ref="packLanguageToggle" :checked="value[field]" :disabled="disabled" @change="onChange" /> {% endblock %} </div> {% endblock %}',{Component:W,Filter:G}=Shopware;W.register("swag-pack-language-entry",{template:z,inject:["acl"],props:{value:{type:Object,required:!0},field:{type:String,required:!0},label:{type:String,required:!0},disabled:{type:Boolean,required:!0,default:!1},description:{type:String,required:!1,default:""},flagLocale:{type:String,required:!1,default:""}},computed:{assetFilter(){return G.getByName("asset")}},methods:{flagSource(e){return e=e.split("-")[1].toLowerCase(),this.assetFilter(`/swaglanguagepack/static/flags/${e}.svg`)},onChange(e){this.value[this.field]=e}}});const J="{% block swag_language_pack_settings_icon %}{% endblock %}",{Component:K}=Shopware;K.register("swag-language-pack-settings-icon",{template:J});const Q=`{% block swag_language_pack_settings %} <sw-page class="swag-language-pack-settings"> {% block swag_language_pack_settings_header %} <template #smart-bar-header> <h2> <span>{{ $tc('sw-settings.index.title') }}</span> <mt-icon name="regular-chevron-right-xs" size="14px" /> <span>{{ $tc('swag-language-pack.settings.header') }}</span> </h2> </template> {% endblock %} {% block swag_language_pack_settings_actions %} <template #smart-bar-actions> {% block swag_language_pack_settings_actions_save %} <sw-button-process class="swag-language-pack-settings__save-action" variant="primary" :process-success="isSaveSuccessful" :disabled="!acl.can('swag_language_pack_language:update')" @process-finish="onSaveFinish" @click="onSave" > {{ $tc('global.default.save') }} </sw-button-process> {% endblock %} </template> {% endblock %} {% block swag_language_pack_settings_content %} <template #content> {% block swag_language_pack_settings_content_card_view %} <sw-card-view> <mt-banner v-if="shopwareHasTranslationSystem" class="swag-language-pack-settings__deprecation-banner" variant="info" > <p v-html="$t('swag-language-pack.settings.deprecationBanner')"></p> </mt-banner> {% block swag_language_pack_settings_content_tabs %} <sw-tabs v-if="!isLoading" class="swag-language-pack-settings__tabs" position-identifier="swag-language-pack-settings__tabs" > {% block swag_language_pack_settings_content_tabs_administration %} <sw-tabs-item class="swag-language-pack-settings__tab-administration" :route="{ name: 'swag.language.pack.index.administration' }" :disabled="!acl.can('language.viewer')" > {{ $tc('swag-language-pack.settings.card.administration.tabTitle') }} </sw-tabs-item> {% endblock %} {% block swag_language_pack_settings_content_tabs_sales_channel %} <sw-tabs-item class="swag-language-pack-settings__tab-sales-channel" :route="{ name: 'swag.language.pack.index.salesChannel' }" :disabled="!acl.can('language.viewer')" > {{ $tc('swag-language-pack.settings.card.salesChannel.tabTitle') }} </sw-tabs-item> {% endblock %} </sw-tabs> {% endblock %} {% block swag_language_pack_settings_content_router_view %} <router-view v-if="!isLoading" :is-loading="isLoading" :pack-languages="packLanguages" /> {% endblock %} {% block swag_language_pack_settings_content_loader %} <mt-loader v-if="isLoading"/> {% endblock %} {% block swag_language_pack_settings_content_verify_user_modal %} <sw-verify-user-modal v-if="confirmPasswordModal" @verified="savePackLanguages" @close="onCloseConfirmPasswordModal" /> {% endblock %} </sw-card-view> {% endblock %} </template> {% endblock %} </sw-page> {% endblock %}`,{Component:X,Defaults:Y}=Shopware,{Criteria:o}=Shopware.Data;X.register("swag-language-pack-settings",{template:Q,inject:["repositoryFactory","userService","acl"],mixins:["notification"],data(){return{isLoading:!1,isSaveSuccessful:!1,hasChanges:!1,packLanguages:[],fallbackLocaleId:null,confirmPasswordModal:!1}},metaInfo(){return{title:this.$createTitle()}},computed:{packLanguageRepository(){return this.repositoryFactory.create("swag_language_pack_language")},languageRepository(){return this.repositoryFactory.create("language")},userRepository(){return this.repositoryFactory.create("user")},packLanguageCriteria(){return new o().addSorting(o.sort("language.name","ASC")).addAssociation("language.salesChannels.domains").addAssociation("language.locale")},shopwareHasTranslationSystem(){return Shopware.Context.app.config.version.replace(/-.*$/,"").localeCompare("6.7.3",void 0,{numeric:!0,sensitivity:"base"})>=0}},created(){this.createdComponent()},beforeRouteLeave(e,a,t){t(),this.hasChanges&&window.location.reload()},methods:{createdComponent(){this.loadPackLanguages()},loadPackLanguages(){return this.isLoading=!0,this.packLanguageRepository.search(this.packLanguageCriteria).then(e=>{this.packLanguages=e}).finally(()=>{this.isLoading=!1})},onSave(){this.confirmPasswordModal=!0},onSaveFinish(){this.isSaveSuccessful=!1},onCloseConfirmPasswordModal(){this.confirmPasswordModal=!1},savePackLanguages(){return this.isLoading=!0,this.validateStates(this.packLanguages).then(()=>this.packLanguageRepository.saveAll(this.packLanguages).then(()=>(this.hasChanges=!0,this.resetInvalidUserLanguages())).catch(()=>{this.createNotificationError({message:this.$tc("swag-language-pack.settings.card.messageSaveError")})})).catch(e=>{const t=`<b>${e.map(n=>n.language.name).join(", ")}</b>`;this.createNotificationError({message:this.$tc("swag-language-pack.settings.card.messageSalesChannelActiveError",{languages:t}),autoClose:!1})}).finally(()=>{this.isLoading=!1,this.isSaveSuccessful=!0,this.loadPackLanguages()})},validateStates(e){return new Promise((a,t)=>{const n=e.filter(i=>!(i.salesChannelActive||i.language.salesChannels.length<=0));n.length>0&&t(n),a()})},async resetInvalidUserLanguages(){const e=await this.fetchInvalidLocaleIds();if(!e||e.length<=0)return Promise.resolve();const a=await this.userService.getUser(),t=new o().addFilter(o.equalsAny("localeId",e));let n=await this.userRepository.search(t);return n=n.reduce((i,l)=>(l.localeId=this.fallbackLocaleId,a.data.id===l.id&&Shopware.Service("localeHelper").setLocaleWithId(l.localeId),i.push(l),i),[]),this.userRepository.saveAll(n)},async fetchInvalidLocaleIds(){const e=new o().addFilter(o.equals("extensions.swagLanguagePackLanguage.administrationActive",!1)),a=await this.languageRepository.search(e),t=new o().setIds([Y.systemLanguageId]),n=await this.languageRepository.search(t);return this.fallbackLocaleId=n.first().localeId,a.map(i=>i.localeId)}}});const Z='{% block swag_language_pack_settings_base %} {% block swag_language_pack_settings_base_card_view_language_selection %} <mt-card class="swag-language-pack-settings-base" position-identifier="swag-language-pack-settings-base" :title="$tc(`swag-language-pack.settings.card.${settingsType}.title`)" :disabled="isLoading" > {% block swag_language_pack_settings_base_card_view_card_loader %} <mt-loader v-if="isLoading"/> {% endblock %} {% block swag_language_pack_settings_base_card_view_description%} <div v-html="description" class="swag-language-pack-settings-base__description" /> {% endblock %} {% block swag_language_pack_settings_base_card_view_language_selection_languages %} <template v-for="packLanguage in packLanguages" :key="packLanguage.id" > {% block swag_language_pack_settings_base_card_view_language_selection_language %} <swag-pack-language-entry v-model:value="packLanguage" class="swag-language-pack-settings-base__entry" :field="`${settingsType}Active`" :label="packLanguage.language.name" :description="packLanguage.language.locale?.code" :flag-locale="packLanguage.language.locale?.code" :disabled="!acl.can(\'swag_language_pack_language:update\')" /> {% endblock %} </template> {% endblock %} </mt-card> {% endblock %} {% endblock %}',{Component:ee}=Shopware;ee.register("swag-language-pack-settings-base",{template:Z,inject:["acl"],props:{isLoading:{type:Boolean,required:!0},packLanguages:{type:Array,required:!0},settingsType:{type:String,required:!0,validator(e){return["administration","salesChannel"].includes(e)}}},computed:{description(){const e=`<a href="#/sw/profile/index">
                ${this.$tc("swag-language-pack.settings.card.administration.descriptionTargetLinkText")}
            </a>`;return this.$tc(`swag-language-pack.settings.card.${this.settingsType}.description`,0,{userInterfaceLanguageLink:e})}}});const ae='{% block swag_language_pack_settings_administration %} <swag-language-pack-settings-base :isLoading="isLoading" :packLanguages="packLanguages" settingsType="administration"> </swag-language-pack-settings-base> {% endblock %}',{Component:te}=Shopware;te.register("swag-language-pack-settings-administration",{template:ae,props:{isLoading:{type:Boolean,required:!0},packLanguages:{type:Array,required:!0}}});const se='{% block swag_language_pack_settings_sales_channel %} <swag-language-pack-settings-base :isLoading="isLoading" :packLanguages="packLanguages" settingsType="salesChannel"> </swag-language-pack-settings-base> {% endblock %}',{Component:ne}=Shopware;ne.register("swag-language-pack-settings-sales-channel",{template:se,props:{isLoading:{type:Boolean,required:!0},packLanguages:{type:Array,required:!0}}});const{Module:ie}=Shopware;ie.register("swag-language-pack",{type:"plugin",name:"SwagLanguagePack",title:"swag-language-pack.general.mainMenuItemGeneral",description:"swag-language-pack.general.descriptionTextModule",version:"1.0.0",targetVersion:"1.0.0",color:"#9AA8B5",icon:"regular-cog",routes:{index:{component:"swag-language-pack-settings",path:"index",redirect:{name:"swag.language.pack.index.administration"},meta:{parentPath:"sw.settings.index",privilege:"language.viewer"},children:{administration:{component:"swag-language-pack-settings-administration",path:"administration",meta:{parentPath:"sw.settings.index",privilege:"language.viewer"}},salesChannel:{component:"swag-language-pack-settings-sales-channel",path:"sales-channel",meta:{parentPath:"sw.settings.index",privilege:"language.viewer"}}}}},settingsItem:{group:"plugins",to:"swag.language.pack.index",icon:"regular-language",backgroundEnabled:!0,privilege:"language.viewer"}});const{Component:ge}=Shopware,{Criteria:k}=Shopware.Data;ge.override("sw-users-permissions-user-detail",{computed:{languageCriteria(){const e=this.$super("languageCriteria");return e.addFilter(k.multi("OR",[k.equals("extensions.swagLanguagePackLanguage.id",null),k.equals("extensions.swagLanguagePackLanguage.administrationActive",!0),k.equals("id",Shopware.Defaults.systemLanguageId)])),e}}});const{Component:re}=Shopware,{Criteria:m}=Shopware.Data;re.override("sw-users-permissions-user-create",{computed:{languageCriteria(){return this.$super("languageCriteria").addFilter(m.multi("OR",[m.equals("extensions.swagLanguagePackLanguage.id",null),m.equals("extensions.swagLanguagePackLanguage.administrationActive",!0),m.equals("id",Shopware.Defaults.systemLanguageId)]))}},methods:{onSave(){this.$super("onSave")}}});
//# sourceMappingURL=swag-language-pack-BQFzNHRV.js.map
